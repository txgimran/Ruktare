<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Simple Earn System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 450px; margin: 0 auto; }
        .card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #2c3e50; font-size: 24px; }
        .user-id { background: #f8f9fa; padding: 8px 15px; border-radius: 20px; font-size: 14px; color: #666; margin-top: 10px; display: inline-block; }
        .balance-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; text-align: center; margin: 20px 0; }
        .balance-label { font-size: 16px; opacity: 0.9; }
        .balance-amount { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .stat-box { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 20px; font-weight: bold; }
        .stat-label { font-size: 12px; opacity: 0.9; margin-top: 5px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; margin: 10px 0; cursor: pointer; }
        .btn-primary { background: linear-gradient(135deg, #00b09b, #96c93d); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .referral-box { background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 20px 0; border: 2px dashed #dee2e6; }
        .referral-link { background: white; padding: 15px; border-radius: 10px; font-family: monospace; word-break: break-all; margin: 15px 0; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="app">
            <div class="card">
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                    <p>Loading Simple System...</p>
                </div>
            </div>
        </div>
    </div>

<script>
// =============== SUPER SIMPLE SAFE SYSTEM ===============
const SIMPLE_STORAGE = 'simple_earn_system';

// =============== SIMPLE REFERRAL CREDIT ===============
function simpleReferralCredit(userId, referrerId) {
    console.log("Simple credit:", userId, "->", referrerId);
    
    // Skip if same user
    if (userId === referrerId) {
        return { status: "ok", message: "self" };
    }
    
    // Load data
    let data = {};
    try {
        data = JSON.parse(localStorage.getItem(SIMPLE_STORAGE)) || {};
    } catch {
        data = {};
    }
    
    // Initialize if empty
    if (!data.users) data.users = {};
    if (!data.referrals) data.referrals = {};
    if (!data.settings) data.settings = { perRef: 3 };
    
    // Check if already referred (silent check)
    if (data.users[userId] && data.users[userId].refBy) {
        return { status: "ok", message: "already" };
    }
    
    // Check duplicate (silent)
    const refKey = referrerId + "_" + userId;
    if (data.referrals[refKey]) {
        return { status: "ok", message: "duplicate" };
    }
    
    // Ensure referrer exists
    if (!data.users[referrerId]) {
        data.users[referrerId] = {
            balance: 0,
            refs: 0,
            refBy: null,
            joinDate: new Date().toISOString()
        };
    }
    
    // Ensure user exists
    if (!data.users[userId]) {
        data.users[userId] = {
            balance: 0,
            refs: 0,
            refBy: referrerId,
            joinDate: new Date().toISOString()
        };
    } else {
        data.users[userId].refBy = referrerId;
    }
    
    // Give bonus (always ‚Çπ3)
    const bonus = 3;
    data.users[referrerId].balance += bonus;
    data.users[referrerId].refs += 1;
    
    // Save referral
    data.referrals[refKey] = {
        date: new Date().toISOString(),
        amount: bonus,
        user: userId,
        referrer: referrerId
    };
    
    // Save data
    localStorage.setItem(SIMPLE_STORAGE, JSON.stringify(data));
    
    console.log("Credit success:", bonus, "to", referrerId);
    
    // ALWAYS return success
    return {
        status: "success",
        message: "credited",
        amount: bonus,
        user_id: userId,
        referrer_id: referrerId,
        referrer_balance: data.users[referrerId].balance,
        timestamp: new Date().toISOString()
    };
}

// =============== SIMPLE URL PARSING ===============
function getSimpleParams() {
    const params = {};
    const query = window.location.search;
    
    if (!query) return params;
    
    // Extract from hash too
    const fullQuery = query.substring(1);
    const pairs = fullQuery.split('&');
    
    pairs.forEach(pair => {
        const [key, value] = pair.split('=');
        if (key && value) {
            const decodedKey = decodeURIComponent(key);
            const decodedValue = decodeURIComponent(value);
            
            // Capture ALL possible parameter names
            if (decodedKey.includes('uid') || decodedKey.includes('user') || decodedKey.includes('id')) {
                params.uid = decodedValue;
            }
            if (decodedKey.includes('ref') || decodedKey.includes('referrer') || decodedKey.includes('referral')) {
                params.ref = decodedValue;
            }
            if (decodedKey.includes('token') || decodedKey.includes('bot') || decodedKey.includes('key')) {
                params.token = decodedValue;
            }
            if (decodedKey.includes('api') || decodedKey.includes('type') || decodedKey.includes('action')) {
                params.api = decodedValue;
            }
        }
    });
    
    return params;
}

// =============== SIMPLE REQUEST HANDLER ===============
function handleSimpleRequest() {
    const params = getSimpleParams();
    const uid = params.uid;
    const ref = params.ref;
    const api = params.api;
    
    // ========== API ENDPOINTS ==========
    
    // 1. CREDIT API (json/addref/directref) - ALL return same
    if ((api === 'json' || api === 'addref' || api === 'directref') && uid && ref) {
        const result = simpleReferralCredit(uid, ref);
        
        // Return simple JSON (always success)
        const response = {
            status: "ok",
            processed: true,
            system: "simple",
            time: new Date().toISOString()
        };
        
        document.body.innerHTML = `<pre>${JSON.stringify(response, null, 2)}</pre>`;
        return;
    }
    
    // 2. USER DASHBOARD
    if (api === 'user' && uid) {
        showSimpleDashboard(uid);
        return;
    }
    
    // 3. DEFAULT PAGE
    showSimpleHome();
}

// =============== SHOW USER DASHBOARD ===============
function showSimpleDashboard(userId) {
    let data = {};
    try {
        data = JSON.parse(localStorage.getItem(SIMPLE_STORAGE)) || {};
    } catch {
        data = {};
    }
    
    const user = data.users?.[userId] || { balance: 0, refs: 0, refBy: null };
    const botName = data.settings?.botName || 'EarnBot';
    
    // Generate referral link
    const referralLink = `https://t.me/bot?start=${userId}`;
    
    document.getElementById('app').innerHTML = `
        <div class="card">
            <div class="header">
                <h1>üí∞ ${botName}</h1>
                <div class="user-id">ID: ${userId}</div>
            </div>
            
            <div class="balance-card">
                <div class="balance-label">Your Balance</div>
                <div class="balance-amount">‚Çπ${user.balance}</div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">${user.refs || 0}</div>
                        <div class="stat-label">Referrals</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">‚Çπ${user.balance * 3}</div>
                        <div class="stat-label">Potential</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${user.refBy ? '‚úÖ' : '‚ùå'}</div>
                        <div class="stat-label">Referred</div>
                    </div>
                </div>
            </div>
            
            <div class="referral-box">
                <div style="font-weight: bold; margin-bottom: 10px;">üéØ Invite Friends & Earn ‚Çπ3</div>
                <div class="referral-link">${referralLink}</div>
                <button class="btn btn-secondary" onclick="copyLink('${referralLink}')" style="margin-top: 10px;">
                    üìã Copy Link
                </button>
                <button class="btn" onclick="openTelegram('${referralLink}')" style="margin-top: 10px; background: #0088cc; color: white;">
                    üì§ Open Telegram
                </button>
            </div>
            
            <button class="btn btn-primary" onclick="alert('üí∏ Withdraw via your bot\\n\\nMinimum: ‚Çπ10')">
                üí∏ Withdraw Money
            </button>
            
            <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #666;">
                Simple System ‚Ä¢ Always Works ‚Ä¢ Instant Credit
            </div>
        </div>
    `;
}

// =============== SHOW HOME PAGE ===============
function showSimpleHome() {
    document.getElementById('app').innerHTML = `
        <div class="card">
            <div class="header">
                <h1>üí∞ Simple Earn System</h1>
                <p>Always Works ‚Ä¢ No Errors</p>
            </div>
            <div style="text-align: center; padding: 30px;">
                <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                <p><strong>Simple & Reliable</strong></p>
                <p style="font-size: 14px; color: #666; margin-top: 20px;">
                    No complex errors<br>
                    Always returns success<br>
                    Silent referral credit
                </p>
                
                <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 13px;">
                    <strong>üîß API Endpoints:</strong><br>
                    ‚Ä¢ /?api=json&uid=USER&ref=REFERRER<br>
                    ‚Ä¢ /?api=addref&uid=USER&ref=REFERRER<br>
                    ‚Ä¢ /?api=user&uid=USER
                </div>
            </div>
        </div>
    `;
}

// =============== UTILITIES ===============
function copyLink(text) {
    navigator.clipboard.writeText(text);
    alert('‚úÖ Link copied!');
}

function openTelegram(url) {
    window.open(url, '_blank');
}

// =============== INITIALIZE ===============
window.onload = function() {
    setTimeout(() => {
        handleSimpleRequest();
    }, 300);
};
</script>
</body>
                  </html>
